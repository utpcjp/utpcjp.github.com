<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">

<html lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <title>Problem G: エナジー・トランスポーター</title>
    <style type="text/css">
      <!--
      h1 {
        text-align: center;
      }

      .timelimit {
        font-weight: bold;
	text-align: right;
      }

      .figure {
        text-align: center;
      }

      .figure table {
        margin-left: auto;
	margin-right: auto;
      }

      pre.sampleinput, pre.sampleoutput {
	padding: 0.5em;
        border: solid thin black;
      }

      .illust {
        margin-left: 3em;
	margin-right: 3em;
      }
      -->
    </style>
  </head>
  <h1>Problem G: エナジー・トランスポーター</h1>
  <p class="timelimit">Time Limit: 5 sec</p>

  <p>
    とある研究所で，
    エネルギー伝達用の媒体の開発をしていた．
    この媒体は図3に示すような特殊な物質からなる
    ポリマー構造をなしている．
  </p>

  <div class="figure">
    <table>
      <tbody>
	<tr>
	  <td>
	    <img src="img/energy.1.png"
		 alt="エネルギー伝達用媒体の構造．">
	  </td>
	</tr>
	<tr>
	  <td>
	    (–α–Ea–β–)<sub><var>n</var></sub>
	  </td>
	</tr>
	<tr>
	  <td>図3: エネルギー伝達用媒体の構造．</td>
	</tr>
      </tbody>
    </table>
  </div>

  <p>
    図の Ea で示した部分がこの媒体のもっとも特徴的な部位の
    エナジーアキュムレータ (Energy Accumulator) である．
    このEa基は 1 kJ 幅で離散化された多様なエネルギー状態を取ることができる．
    あるEa基を励起させると，
    そのEa基のα側に結合している隣接したEa基に蓄積されている全エネルギーを
    β側に結合している隣接したEa基に移動させるような効果を持つ
    発熱反応が引き起こされる（図4）．
    この反応の際，励起されるEa基のエネルギーが 1 kJ 消費される．
    なお，ポリマーの両端に位置するEa基やエネルギー状態が 0 kJ になっている
    Ea基に対しては励起反応は発生しないこと，
    およびEa基は十分に大きなエネルギーを蓄えることが可能であることが知られている．
  </p>

  <div class="figure">
    <table>
      <tbody>
	<tr>
	  <td>
	    <img src="img/energy.2.png"
		 alt="中央のEa基を励起させたときの反応．">
	  </td>
	</tr>
	<tr>
	  <td>図4: 中央のEa基を励起させたときの反応．</td>
	</tr>
      </tbody>
    </table>
  </div>

  <p>
    この性質を利用することでエネルギーの伝達を可能にしようと考えていたのだが，
    エネルギーを効率よく伝達するには各Ea基を励起させる順番が重要であることに
    研究者たちは気がついたのである．
  </p>

  <p>
    幸い，励起させる順番や回数は任意に制御できるのだが，
    彼らには最適な励起手順がわからない．
    そこで彼らの発想の足がかりとして，
    初期状態のエネルギー分布に対して
    最右Ea基（β末端からもっとも近いEa基）
    に蓄えられうる最大のエネルギー量を計算してもらいたい．
  </p>

  <h2>Input</h2>
  <p>
    入力は複数のデータセットから構成され，
    以下のような形式で与えられる．
  </p>

  <div class="illust">
    <var>N</var><br>
    <var>C</var><sub>1</sub><br>
    <var>C</var><sub>2</sub><br>
    ...<br>
    <var>C</var><sub><var>N</var></sub>    
  </div>

  <p>
    入力の先頭の整数 <var>N</var>
    (0 &lt; <var>N</var> &le; 60) が取り扱う問題のデータセット数であり，
    その後ろ 2<var>N</var> 行に渡って，
    それぞれのデータセットごとの情報 <var>C</var><sub><var>k</var></sub>
    が与えられる．
  </p>

  <p>
    それぞれのデータセット <var>C</var><sub><var>k</var></sub>
    は以下のような形式で
    2行に渡り与えられる．
  </p>

  <div class="illust">
    <var>L</var><br>
    <var>E</var><sub>1</sub> <var>E</var><sub>2</sub> ...
    <var>E</var><sub><var>L</var></sub>
  </div>

  <p>
    <var>L</var> はそれぞれのデータセットで取り扱う媒体のEa鎖の長さであり，
    ここで与えられた数だけEa基が直列に結合していることを意味している．
    その次の行の <var>L</var> 個の整数 <var>E</var><sub><var>k</var></sub> は，
    長さ<var>L</var>のEa鎖のうちα末端を左端に据えたときに
    左から数えて<var>k</var>番目のEa鎖にはじめに蓄積されているエネルギー量を
    kJ単位で示したものである．
  </p>

  <p>
    ここで， 0 &le; <var>E</var><sub><var>k</var></sub> &le; 4,
    1 &le; <var>L</var> &le; 80 であることが保証されている．
  </p>

  <h2>Output</h2>
  <p>
    出力は各データセットごとに，与えられた状況下での右端Ea鎖に到達可能な
    最大エネルギーをkJ単位で，整数値のみを1行で記述すること．
  </p>

  <h2>Sample Input</h2>
  <pre class="sampleinput">7
1
2
2
1 2
3
4 1 4
3
4 0 4
5
4 1 4 0 4
5
4 1 4 1 4
5
4 2 4 0 4</pre>

  <h2>Output for the Sample Input</h2>
  <pre class="sampleoutput">2
2
8
4
7
12
11</pre>

  <hr>
  <address>
    東京大学プログラミングコンテスト2008<br>
    Problemsetter: Koji Kojima
  </address>
</html>
